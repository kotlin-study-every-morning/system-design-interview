## 문제 이해 및 설계 범위 확정
- 빠른 비디오 업로드
- 원활한 비디오 재생
- 재생 품질 선택 가능
- 낮은 인프라 비용
- 높은 가용성과 규모 확장성, 그리고 안정성
- 지원 클라이언트: 모바일 앱, 웹 브라우저, 그리고 스마트 TV

### 개략적 규모 추정
- DAU: 5백만
- 한사용자 당 하루 5개 비디오 시청
- 10% 사용자가 하루 1개 비디오 업로드
- 비디오 평균 크기 300MB
- 매일 요구되는 용량 = 5백만 * 10% * 300MB = 150TB
- CDN 비용 = $150,000

## 개략적 설계안 제시 및 동의 구하기
- 적절한 기술을 고르는 것이 중요
- 사용할 기술에 대한 설명 대신 사실만 언급해도 충분
- 상세한 설계를 제시하지 않는 것
- CDN을 직접 만들기 보단 상용 클라우드 서비스를 이용

### 비디오 업로드 절차
- 비디오 업로드
  1. 원본 저장소 업로드
  2. 원본 저장소에서 가져와 트랜스 코딩 시작
  3. 완료 비디오를 트랜스 코딩 저장소로 업로드
  4. 트랜스 코딩 완료 이벤트를 완료 큐에 삽입
  5. API서버에 스트리밍 준비 완료를 알림
  6. 메타 데이터 갱신

### 비디오 스트리밍 절차
- 스트리밍 프로토콜 결정
- CDN에서 바로 스트리밍 시작

## 상세 설계

### 비디오 트랜스 코딩
- 가공되지 않은 원본 비디오는 많은 저장소를 차지
- 특정 종류의 비디오 포맷만 지원하여 여러 포맷으로 인코딩 필요
- 대역폭이 충분한 네트워크 확보
- 다양한 해상도 지원

### 유향 비순환 그래프(DAG) 모델
- 각기 다른 유형의 비디오 프로세싱 파이프라인 지원
- 처리 과정의 병렬성을 높이기 위한 적절한 수준의 추상화
- 이러한 과정을 위한 작업을 단계별로 배열 할 수 있는 DAG모델 도입

### 비디오 트랜스코딩 아키텍처

#### 전처리기
1. 비디오 분할 : GOP(Group Of Picture)단위로 비디오를 분할
2. DAG생성 : 클라이언트 프로그래머가 작성한 설정 파일에 따라 DAG 생성
3. 데이터 캐시: 안정성을 높이기 위해 GOP와 메타데이터를 임시 저장소에 보관

#### DAG 스케줄러
- DAG그래프를 몇단계로 분할해 각각을 작업큐에 집어 넣는다.

#### 자원 관리자
- 몇개의 작업 큐와 작업 스케줄러로 구성되어 작업을 진행

#### 작업 서버
- DAG에 정의된 작업을 수행

#### 임시 저장소
- 데이터 유형, 이용 빈도, 데이터 유효기간 등에 따라 다양한 저장소 시스템 활용
- 캐시 혹은 BLOB 저장소를 이용하고 프로세싱이 완료되면 삭제

#### 시스템 최적화
- 속도 최적화 : 비디오 병렬 업로드
- 속도 최적화 : 업로드 센터를 사용자 근거리에 지정
- 속도 최적화 : 모든 절차를 병렬화
- 안정성 최적화 : 미리 사인된 업로드 URL
- 안정성 최적화 : 비디오 보호
- 비용 최적화 : 롱테일에 따른 최적화 시도

### 오류 처리
- 회복 가능 오류 : 재시도 및 적절한 오류 코드 반환
- 회복 불가능 오류 : 작업 중단 및 적절한 오류 코드 반환

#### 오류 종류
- 업로드 오류
- 비디오 분할
- 트랜스코딩 오류
- 전처리 오류
- DAG 스케줄러 오류
- 자원 관리자 큐에 장애 발생
- 작업 서버 장애
- API 서버 장애
- 메타데이터 캐시 서버 장애
- 메타데이터 데이터베이스 서버 장애